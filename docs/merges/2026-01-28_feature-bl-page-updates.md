# Merge Report: feature/bl-page-updates

**Date:** 2026-01-28
**Branch:** feature/bl-page-updates
**Track:** FEATURE
**PR:** https://github.com/chrishadley1983/hadley-bricks-inventory-management/pull/23
**Commit:** 6b0c1d0cba5cff5bb15ec59b909baa54de525f44

---

## Summary

Unified arbitrage page consolidating BrickLink, eBay, and Seeded ASIN tracking into a single tabbed interface with improved metrics and sorting capabilities.

## Changes

### New Features
- **Unified arbitrage page**: Single `/arbitrage` page with BrickLink, eBay, and Seeded tabs
- **COG % metric**: Replaced Margin % with Cost of Goods % (lower = better margin)
- **Sortable columns**: Clickable column headers for sorting by price, COG%, BL min, sales rank, lots
- **BL price override**: Per-ASIN minimum BrickLink price override to work around API limitation (sellers with high min spend)

### Files Changed (19 files, +2,126 / -1,190)

| File | Change |
|------|--------|
| `apps/web/src/app/(dashboard)/arbitrage/page.tsx` | New unified page with tabs |
| `apps/web/src/app/(dashboard)/arbitrage/amazon/page.tsx` | Redirect to unified page |
| `apps/web/src/app/(dashboard)/arbitrage/ebay/page.tsx` | Redirect to unified page |
| `apps/web/src/app/(dashboard)/arbitrage/seeded/page.tsx` | Redirect to unified page |
| `apps/web/src/components/features/arbitrage/ArbitrageTable.tsx` | Sortable headers, COG % column |
| `apps/web/src/components/features/arbitrage/ArbitrageDetailModal.tsx` | BL price override input |
| `apps/web/src/app/api/arbitrage/[asin]/route.ts` | setOverride action |
| `apps/web/src/hooks/use-arbitrage.ts` | useSetBlPriceOverride hook |
| `apps/web/src/lib/arbitrage/arbitrage.service.ts` | setBlPriceOverride method |
| `apps/web/src/lib/arbitrage/types.ts` | New types for sorting, COG% |
| `apps/web/src/components/layout/Sidebar.tsx` | Simplified nav |
| `packages/database/src/types.ts` | Database type updates |
| `supabase/migrations/20260128100001_add_bl_price_override.sql` | Override column migration |
| `docs/api-limitations.md` | BrickLink API limitation docs |
| `docs/features/bl-page-updates/done-criteria.md` | Done criteria |
| `docs/features/bl-page-updates/feature-spec.md` | Feature spec |

---

## Verification Results

| Check | Status | Notes |
|-------|--------|-------|
| TypeScript | ✅ Pass | No errors |
| ESLint | ✅ Pass | Warnings only (pre-existing `<img>` usage) |
| Branch pushed | ✅ Pass | `origin/feature/bl-page-updates` |
| PR created | ✅ Pass | PR #23 |

---

## Technical Details

### COG % Calculation
```sql
cog_percent = (effective_bl_price / effective_amazon_price) * 100
effective_bl_price = GREATEST(bl_min_price, COALESCE(min_bl_price_override, 0))
effective_amazon_price = COALESCE(buy_box_price, your_price)
```

### URL Tab State
- Default: `/arbitrage` → BrickLink tab
- eBay: `/arbitrage?tab=ebay`
- Seeded: `/arbitrage?tab=seeded`
- Old URLs redirect automatically

### BL Price Override
Workaround for BrickLink API limitation - seller IDs are anonymized, so we can't filter out sellers with high minimum order requirements. Users can set a minimum price override per-ASIN.

---

## Next Steps

1. Merge PR #23 after review
2. Apply migration: `npm run db:push`
3. Regenerate types: `npm run db:types`
4. Monitor production for any issues

---

*Generated by Merge Feature Agent*
